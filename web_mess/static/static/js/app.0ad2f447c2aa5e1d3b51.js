webpackJsonp([1],{"6PsQ":function(t,e){},"9V3S":function(t,e){},BeNq:function(t,e){},CuRo:function(t,e){},ISZ9:function(t,e){},IZw6:function(t,e){},Kw4L:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("7+uW"),i=s("qBrr"),n=s.n(i),r=s("9JMe"),o=s("bNL2"),c=s.n(o),l=s("mtWM"),u=s.n(l),d=(s("CuRo"),s("zVO7"),{render:function(){var t=this.$createElement,e=this._self._c||t;return this.isLogin()?e("div",{attrs:{id:"header"}},[this._m(0)]):this._e()},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"head"},[e("div",{staticClass:"menu"},[e("div",{staticClass:"icon ion-navicon"}),this._v(" "),e("div",{staticClass:"title"},[this._v("Messanger")])]),this._v(" "),e("div",{staticClass:"wrapper"})])}]});var m={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]};var v={name:"App",components:{UiHeader:s("VU/8")({data:function(){return{}},methods:{isLogin:function(){return!!this.$store.state.auth.token}}},d,!1,function(t){s("6PsQ")},null,null).exports,UiModal:s("VU/8")({name:"Modal",data:function(){return{}}},m,!1,function(t){s("ISZ9")},"data-v-23e784d8",null).exports},watch:{$route:function(t,e){var s=this;"dialogs"==t.name&&u.a.get(this.$store.state.server+"/api/getPuddles",{params:{token:this.$store.state.auth.token}}).then(function(t){var e=t.data;(console.log(e),e.ok)?e.puddles.map(function(t){s.$store.commit("addDialog",t),t.members.map(function(t){u.a.get(s.$store.state.server+"/api/getProfile",{params:{token:s.$store.state.auth.token,username:t}}).then(function(t){var e=t.data;e.ok&&s.$store.commit("addUser",e.profile)})})}):console.error(e.message)})}}},h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("ui-header"),this._v(" "),e("router-view"),this._v(" "),e("ui-modal")],1)},staticRenderFns:[]};var g=s("VU/8")(v,h,!1,function(t){s("BeNq")},null,null).exports,f=s("/ocq"),p={name:"Sidebar",data:function(){return{}},methods:{openDialog:function(t){var e=this;this.$store.commit("setDialog",{id:t,messages:!1}),this.$router.push({name:"dialog",params:{id:t}}),u.a.get(this.$store.state.server+"/api/getPuddleMessages",{params:{token:this.$store.state.auth.token,puddle_id:t}}).then(function(t){if(t.data.ok)return t.data.messages}).then(function(s){console.log(s),s.reverse(),e.$store.commit("setDialog",{id:t,messages:s})})},getDateTime:function(t){new Date;var e=new Date(t);return e.getFullYear()+"."+e.getMonth()+"."+e.getDay()}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sidebar"},[t._m(0),t._v(" "),t.$store.state.dialogs.length>0?s("div",{staticClass:"dialogs"},t._l(t.$store.state.dialogs,function(e,a){return s("div",{staticClass:"dialog",class:{active:e.id==t.$store.state.dialog.id},on:{click:function(s){t.openDialog(e.id)}}},[s("div",{staticClass:"time"},[t._v(t._s(t.getDateTime(e.last_message.timestamp)))]),t._v(" "),s("div",{staticClass:"image"},[s("img",{attrs:{src:e.avatar?t.$store.state.server+"/file/"+e.avatar:"/static/img/avatar.png"}})]),t._v(" "),s("div",{staticClass:"data"},[s("div",{staticClass:"username"},[t._v(t._s(e.display_name))]),t._v(" "),s("div",{staticClass:"message"},[t._v(t._s(e.last_message.text))])])])})):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"search"},[e("div",{staticClass:"form"},[e("input",{attrs:{type:"text",name:"q",placeholder:"Search"}})])])}]};var C=s("VU/8")(p,_,!1,function(t){s("Kw4L")},"data-v-208f0362",null).exports,$={name:"dialog",components:{UiSidebar:C},methods:{getDateTime:function(t){new Date;var e=new Date(t);return e.getFullYear()+"."+e.getMonth()+"."+e.getDay()},getAvatar:function(t){return this.$store.state.users[t]&&this.$store.state.users[t].avatar?this.$store.state.server+"/file/"+this.$store.state.users[t].avatar:"/static/img/avatar.png"}}},w={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"main"}},[s("ui-sidebar"),t._v(" "),s("div",{staticClass:"content"},[s("div",{directives:[{name:"chat-scroll",rawName:"v-chat-scroll"}],staticClass:"messages"},t._l(t.$store.state.dialog.messages,function(e,a){return s("div",{staticClass:"message",class:{my:e.from==t.$store.state.auth.username}},[s("div",{staticClass:"data"},[s("div",{staticClass:"image"},[s("img",{attrs:{src:t.getAvatar(e.from)}})]),t._v(" "),s("div",{staticClass:"time"},[t._v(t._s(t.getDateTime(e.timestamp)))]),t._v(" "),s("div",{staticClass:"data"},[s("div",{staticClass:"username"},[t._v(t._s(e.from))]),t._v(" "),s("div",{staticClass:"message"},[s("div",{staticClass:"text"},[t._v(t._s(e.text))])])])])])})),t._v(" "),s("div",{staticClass:"bottom_form"},[s("div",{staticClass:"messages"}),t._v(" "),s("div",{staticClass:"send_form"},[s("div",{staticClass:"avatar my"},[s("img",{attrs:{src:t.getAvatar(t.$store.state.auth.username)}})]),t._v(" "),t._m(0),t._v(" "),t._m(1)])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"avatar other"},[e("img",{attrs:{src:"http://img1.ak.crunchyroll.com/i/spire3/3614810e9ada5235038e8deb4adc264c1447729591_large.jpg"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form"},[e("textarea",{attrs:{placeholder:"Write a message..."}}),this._v(" "),e("div",{staticClass:"line"},[e("div",{staticClass:"left"},[e("div",{staticClass:"icon ion-document"}),this._v(" "),e("div",{staticClass:"icon ion-image"})]),this._v(" "),e("div",{staticClass:"send"},[this._v("SEND "),e("i",{staticClass:"ion-android-send"})])])])}]};var k=s("VU/8")($,w,!1,function(t){s("IZw6")},null,null).exports,b={name:"dialog",components:{UiSidebar:C}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"main"}},[e("ui-sidebar"),this._v(" "),this._m(0)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("p",{staticClass:"content-text"},[this._v("Please select puddle in side menu")])])}]};var y=s("VU/8")(b,x,!1,function(t){s("fTYY")},"data-v-644c529f",null).exports,D={data:function(){return{form:{username:"admin",password:"123"},message:null}},methods:{SignIn:function(){var t=this;u.a.post(this.$store.state.server+"/api/generateToken",this.form).then(function(e){return console.log(e.data),e.data.ok?(t.message=null,e.data):(t.message=e.data.message,!1)}).then(function(e){if(!e)return!1;t.$db.put({_id:"auth",token:e.token,username:e.username}).then(function(){t.$store.dispatch("setAuth",e)}).then(function(){t.$router.push({name:"dialogs"})}).catch(function(e){t.message=e})}).catch(function(t){console.log(t)})}}},U={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"auth"}},[s("div",{staticClass:"header"}),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"menu"},[s("div",{staticClass:"logo"},[t._v("Mess")]),t._v(" "),s("div",{staticClass:"button",on:{click:this.SignIn}},[t._v("Next "),s("i",{staticClass:"ion-chevron-right"})])]),t._v(" "),s("div",{staticClass:"block login"},[s("div",{staticClass:"title"},[t._v("Sign in")]),t._v(" "),s("div",{staticClass:"desc"},[t._v("Please enter you're username and password")]),t._v(" "),s("div",{staticClass:"form"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],attrs:{type:"text",placeholder:"Username"},domProps:{value:t.form.username},on:{input:function(e){e.target.composing||t.$set(t.form,"username",e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],attrs:{type:"password",placeholder:"Password"},domProps:{value:t.form.password},on:{input:function(e){e.target.composing||t.$set(t.form,"password",e.target.value)}}})]),t._v(" "),t.message?s("p",{staticClass:"message"},[t._v(t._s(t.message))]):t._e()])])])},staticRenderFns:[]};var E=s("VU/8")(D,U,!1,function(t){s("9V3S")},"data-v-2e7117df",null).exports,S={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"auth"}},[s("div",{staticClass:"header"}),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"menu"},[s("div",{staticClass:"logo"},[t._v("Mess")]),t._v(" "),s("div",{staticClass:"button"},[t._v("Next "),s("i",{staticClass:"ion-chevron-right"})])]),t._v(" "),s("div",{staticClass:"block login"},[s("div",{staticClass:"title"},[t._v("Sign in")]),t._v(" "),s("div",{staticClass:"desc"},[t._v("Please enter you're email and password")]),t._v(" "),s("div",{staticClass:"form"},[s("input",{attrs:{type:"email",placeholder:"you.email@mess.com"}}),t._v(" "),s("input",{attrs:{type:"text",placeholder:"you're login"}}),t._v(" "),s("input",{attrs:{type:"password",placeholder:"you're password"}})])])])])}]},A=s("VU/8")({},S,!1,null,null,null).exports;a.a.use(f.a);var N=new f.a({routes:[{path:"/login",component:E,name:"login"},{path:"/register",component:A,name:"register"},{path:"/",component:y,name:"dialogs"},{path:"/im/:id",component:k,name:"dialog"},{path:"*",redirect:"/login"}]}),P=s("NYxO"),V=s("Gu7T"),M=s.n(V),T=s("Dd8w"),F=s.n(T),R={setToken:function(t,e){t.auth=F()({},t.auth,{token:e})},setUsername:function(t,e){t.auth=F()({},t.auth,{username:e})},addDialog:function(t,e){t.dialogs=[].concat(M()(t.dialogs),[e])},setDialog:function(t,e){t.dialog=F()({},t.dialog,e)},addUser:function(t,e){console.log(e),t.users[e.username]=e,t.users=F()({},t.users)}};a.a.use(P.a);var Y=new P.a.Store({state:{server:"http://127.0.0.1:8000",auth:{token:!1,username:!1},dialogs:[],dialog:{messages:!1},users:{}},mutations:R,actions:{setAuth:function(t,e){t.commit("setToken",e.token),t.commit("setUsername",e.username)}}}),I=s("Zrlr"),q=s.n(I),L=s("wxAW"),O=s.n(L),Z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q()(this,t),this.db=e.db,this.store=e.store,this.router=e.router}return O()(t,[{key:"run",value:function(){this.loadAuth()}},{key:"loadAuth",value:function(){var t=this;this.db.get("auth").then(function(e){e.token&&e.username&&t.store.dispatch("setAuth",{token:e.token,username:e.username})}).then(function(){t.router.push("/")}).catch(function(t){console.error(t)})}}]),t}();a.a.config.productionTip=!1,a.a.config.devtools=!0,n.a.connect({name:"mess-web"}),console.log(n.a),new Z({db:n.a.db,store:Y,router:N}).run(),N.beforeEach(function(t,e,s){Y.state.auth.token?"login"==t.name&&"register"==t.name&&s("/"):"login"!=t.name&&"register"!=t.name&&s("/login"),s()}),Object(r.sync)(Y,N),a.a.use(c.a),a.a.use(n.a),new a.a({store:Y,router:N,el:"#app",components:{App:g},template:"<App/>"})},fTYY:function(t,e){},zVO7:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.0ad2f447c2aa5e1d3b51.js.map